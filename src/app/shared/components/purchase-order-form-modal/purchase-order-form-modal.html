<app-modal [isOpen]="isOpen" [title]="order ? 'Edit Purchase Order' : 'New Purchase Order'" size="lg" (close)="onClose()">
  <form [formGroup]="form" (ngSubmit)="onSave()">
    <div class="space-y-4">
      <!-- Header Fields -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Supplier</label>
          <select formControlName="supplierId" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
            <option value="">Select Supplier</option>
            <option *ngFor="let s of suppliers" [value]="s.id">{{ s.name }}</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Warehouse</label>
          <select formControlName="warehouseId" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
            <option value="">Select Warehouse</option>
            <option *ngFor="let w of warehouses" [value]="w.id">{{ w.name }}</option>
          </select>
        </div>

        <div>
           <label class="block text-sm font-medium text-gray-700 mb-1">Expected Delivery</label>
           <input type="date" formControlName="expectedDelivery" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
        </div>
      </div>

      <!-- Order Lines -->
      <div class="mt-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Order Items</label>
        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
          <div formArrayName="lines">
            <div *ngFor="let line of lines.controls; let i = index" [formGroupName]="i" class="flex gap-4 mb-3 items-end">
              <div class="flex-1">
                <label *ngIf="i===0" class="block text-xs text-gray-500 mb-1">Product</label>
                <select formControlName="productId" class="w-full px-3 py-2 border rounded-lg text-sm">
                  <option value="">Select Product</option>
                  <option *ngFor="let p of products" [value]="p.id">{{ p.name }} ({{ p.sku }})</option>
                </select>
              </div>
              <div class="w-24">
                <label *ngIf="i===0" class="block text-xs text-gray-500 mb-1">Quantity</label>
                <input type="number" formControlName="quantity" class="w-full px-3 py-2 border rounded-lg text-sm" min="1">
              </div>
              <div class="w-32">
                 <label *ngIf="i===0" class="block text-xs text-gray-500 mb-1">Unit Cost</label>
                 <input type="number" formControlName="unitCost" class="w-full px-3 py-2 border rounded-lg text-sm" min="0">
              </div>
              <button type="button" (click)="removeLine(i)" class="text-red-500 hover:bg-red-50 p-2 rounded-lg" title="Remove Item">
                üóëÔ∏è
              </button>
            </div>
          </div>
          <button type="button" (click)="addLine()" class="mt-2 text-sm text-indigo-600 font-medium hover:text-indigo-800 flex items-center gap-1">
             <span>‚ûï</span> Add Another Item
          </button>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="mt-6 flex justify-end gap-3">
      <button type="button" (click)="onClose()" class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
        Cancel
      </button>
      <button type="submit" [disabled]="form.invalid || loading" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50">
        {{ order ? 'Update Order' : 'Create Order' }}
      </button>
    </div>
  </form>
</app-modal>
